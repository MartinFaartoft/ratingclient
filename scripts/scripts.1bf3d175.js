"use strict";angular.module("ratingClient",["ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap"]).config(["$routeProvider","$httpProvider","$resourceProvider",function(a,b,c){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/ratinglist/:gameType",{templateUrl:"views/ratinglist.html",controller:"RatinglistCtrl"}).when("/players",{templateUrl:"views/players.html",controller:"PlayersCtrl"}).when("/players/:playerId",{templateUrl:"views/playerdetails.html",controller:"PlayerDetailsCtrl"}).when("/creategame",{templateUrl:"views/creategame.html",controller:"CreateGameCtrl"}).when("/createplayer",{templateUrl:"views/createplayer.html",controller:"CreatePlayerCtrl"}).when("/games",{templateUrl:"views/games.html",controller:"GamesCtrl"}).otherwise({redirectTo:"/"}),b.interceptors.push("authInterceptor"),c.defaults.stripTrailingSlashes=!1}]).constant("baseUrl","https://ratinglist.herokuapp.com"),angular.module("ratingClient").controller("IndexCtrl",["$scope","$route","$routeParams","authService",function(a,b,c,d){a.auth=d,a.login=function(){d.login(a.user.username,a.user.password),a.user={}},a.logout=function(){d.logout()}}]),angular.module("ratingClient").controller("MainCtrl",function(){}),angular.module("ratingClient").factory("authService",["$http","baseUrl","$window","$rootScope",function(a,b,c,d){var e=Boolean(window.sessionStorage.token),f=c.sessionStorage.token?c.jwt_decode(window.sessionStorage.token):{},g=function(d,e){var f=this,g=b+"/api-token-auth/";a.post(g,{username:d,password:e}).success(function(a){c.sessionStorage.token=a.token,f.user=window.jwt_decode(a.token),console.log(f.user),f.isLoggedIn=!0}).error(function(a,b){c.alert(b)})};d.auth=this;var h=function(){window.sessionStorage.removeItem("token"),this.user={},this.isLoggedIn=!1};return{isLoggedIn:e,user:f,login:g,logout:h}}]),angular.module("ratingClient").factory("authInterceptor",["$rootScope","$q","$window",function(a,b,c){return{request:function(a){return a.headers=a.headers||{},c.sessionStorage.token&&(a.headers.Authorization="JWT "+c.sessionStorage.token),a},response:function(a){return 401===a.status,a||b.when(a)}}}]),angular.module("ratingClient").factory("Player",["$resource","baseUrl",function(a,b){return a(b+"/players/:id/",{id:"@id"},{update:{method:"PUT"}})}]).factory("Game",["$resource","baseUrl",function(a,b){return a(b+"/games/:id/",{id:"@id"},{update:{method:"PUT"}})}]),angular.module("ratingClient").controller("RatinglistCtrl",["$scope","$routeParams","$http","baseUrl",function(a,b,c,d){a.gameType=b.gameType,a.model={ratingList:[]};var e=d+"/ratinglist/"+a.gameType+"/";c.get(e).success(function(b){a.model.ratingList=b})}]),angular.module("ratingClient").controller("PlayersCtrl",["$scope","Player","$window",function(a,b,c){a.model={players:b.query()},a["delete"]=function(b){var d=a.model.players.indexOf(b),e=function(){a.model.players.splice(d,1)},f=function(a){c.alert(a.data.detail)};b.$delete(null,e,f)}}]),angular.module("ratingClient").controller("PlayerDetailsCtrl",["$scope","$routeParams","Player",function(a,b,c){a.model={player:c.get({id:b.playerId})},a.save=function(){a.model.player.$update()}}]),angular.module("ratingClient").controller("CreateGameCtrl",["$scope","Game","Player","$window",function(a,b,c,d){var e=function(){a.model={game:new b,players:c.query()},a.model.game.game_players=[{order:1},{order:2},{order:3},{order:4}]};e(),a.save=function(){a.model.game.finished_time=a.model.date+"T"+a.model.finished_time+":00Z",a.model.game.$save(null,function(){d.alert("Game created"),e()})}}]),angular.module("ratingClient").controller("CreatePlayerCtrl",["$scope","Player","$window",function(a,b,c){a.model={player:new b},a.save=function(){a.model.player.$save(null,function(){c.alert("player created"),a.model.player=new b})}}]),angular.module("ratingClient").controller("GamesCtrl",["$scope","Game","$window",function(a,b,c){a.model={games:b.query()},a["delete"]=function(b){var d=a.model.games.indexOf(b),e=function(){a.model.games.splice(d,1)},f=function(a){c.alert(a.data.detail)};b.$delete(null,e,f)}}]);